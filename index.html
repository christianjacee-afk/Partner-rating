<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TiffanyTinx Ratings</title>

<link href="https://fonts.googleapis.com/css2?family=Metal+Mania&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
body {
  background:#0a0a0a;
  color:#eee;
  font-family:'Cinzel', serif;
  padding:20px;
}

.container {
  max-width:800px;
  margin:auto;
  background:#151515;
  padding:30px;
  border-radius:12px;
  border:4px solid #ff0000;
  box-shadow:0 0 25px rgba(255,0,0,.5);
  position:relative;
}

h1 {
  font-family:'Metal Mania', cursive;
  text-align:center;
  font-size:4em;
  color:#ff0000;
  margin-bottom:30px;
}

label {
  display:block;
  margin-top:15px;
  margin-bottom:5px;
  color:#ffaaaa;
}

input, select, textarea {
  width:100%;
  padding:10px;
  background:#222;
  border:2px solid #ff0000;
  color:#fff;
  border-radius:6px;
}

/* SAVE BUTTON */
#saveBtn {
  margin-top:20px;
  width:100%;
  padding:15px;
  font-size:1.2em;
  font-weight:bold;
  letter-spacing:1px;
  background:linear-gradient(145deg,#ff0000,#aa0000);
  border:none;
  border-radius:10px;
  color:white;
  cursor:pointer;
  box-shadow:0 6px #550000, 0 0 15px rgba(255,0,0,.8);
  transition:all .15s ease;
  position:relative;
  overflow:hidden;
}

#saveBtn i { margin-right:8px; }

#saveBtn:active {
  transform:translateY(6px);
  box-shadow:0 0 #550000, 0 0 25px rgba(255,0,0,1);
}

/* ðŸ”¥ FLAME BURST */
.flame {
  position:absolute;
  bottom:0;
  width:12px;
  height:12px;
  background:radial-gradient(circle at center, #fff 0%, #ff0 30%, #ff4500 70%);
  border-radius:50%;
  animation:flameUp 1s ease-out forwards;
  pointer-events:none;
}

@keyframes flameUp {
  0% { transform:translateY(0) scale(1); opacity:1; }
  100% { transform:translateY(-120px) scale(0.2); opacity:0; }
}

/* RATINGS */
.rating {
  background:#222;
  margin-top:20px;
  padding:15px;
  border-radius:8px;
  border:1px solid #444;
}

.stars { color:gold; }

/* ADMIN */
.secret-toggle {
  position:fixed;
  bottom:20px;
  right:20px;
  width:55px;
  height:55px;
  border-radius:50%;
  background:#ff0000;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:1.5em;
  cursor:pointer;
  box-shadow:0 0 15px rgba(255,0,0,.8);
}

#adminPanel {
  position:fixed;
  bottom:90px;
  right:20px;
  background:#330000;
  padding:15px;
  border-radius:8px;
  border:2px solid #ff0000;
  display:none;
  width:220px;
}
</style>
</head>

<body>

<div class="container">
<h1>TiffanyTinx</h1>

<label>Name</label>
<input id="name" placeholder="Anonymous">

<label>Character</label>
<select id="character">
  <option>Pim</option>
  <option>Charlie</option>
  <option>Glep</option>
  <option>Mr Boss</option>
</select>

<label>Stars</label>
<select id="stars">
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
</select>

<label>PP Energy</label>
<select id="pp">
  <option>1</option><option>2</option><option>3</option>
  <option>4</option><option>5</option><option>6</option>
  <option>7</option><option>8</option><option>9</option><option>10</option>
</select>

<label>Comment</label>
<textarea id="review"></textarea>

<button id="saveBtn"><i class="fas fa-skull"></i> SAVE RATING</button>

<div id="list"></div>
</div>

<div class="secret-toggle" id="adminToggle">
  <i class="fas fa-anchor"></i>
</div>

<div id="adminPanel">
  <label>Admin Password</label>
  <input type="password" id="adminPass">
  <button id="adminLogin">Login</button>
  <p id="adminStatus"></p>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC7srqV5cigcYZEdGIW5O8jl-LoA5nNECk",
  authDomain: "tiffanytinx-bbf9c.firebaseapp.com",
  databaseURL: "https://tiffanytinx-bbf9c-default-rtdb.firebaseio.com",
  projectId: "tiffanytinx-bbf9c"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
firebase.database().goOffline();
firebase.database().goOnline();
const ratingsRef = db.ref("ratings");

/* ADMIN */
const ADMIN_PASSWORD = "ppeanile";
let isAdmin = false;

adminToggle.onclick = () => {
  adminPanel.style.display = adminPanel.style.display === "block" ? "none" : "block";
};

adminLogin.onclick = () => {
  if (adminPass.value === ADMIN_PASSWORD) {
    isAdmin = true;
    adminStatus.textContent = "Admin enabled";
    adminStatus.style.color = "#0f0";
    adminPanel.style.display = "none";
  } else {
    adminStatus.textContent = "Wrong password";
    adminStatus.style.color = "#f00";
  }
};

/* ðŸ”¥ Flame burst */
function flameBurst() {
  for (let i = 0; i < 12; i++) {
    const f = document.createElement("div");
    f.className = "flame";
    f.style.left = Math.random() * 100 + "%";
    saveBtn.appendChild(f);
    setTimeout(() => f.remove(), 1000);
  }
}

/* SAVE */
saveBtn.onclick = () => {
  const starsVal = parseInt(stars.value);

  ratingsRef.push({
    name: name.value || "Anonymous",
    character: character.value,
    stars: starsVal,
    pp: parseInt(pp.value),
    review: review.value,
    timestamp: Date.now(),
    isToken: starsVal === 5,
    ...(starsVal === 5 ? { claimed:false } : {})
  });

  if (starsVal === 5) flameBurst();

  name.value = review.value = "";
};

/* DELETE */
window.deleteRating = id => {
  if (!isAdmin) return;
  if (confirm("Delete this rating?")) ratingsRef.child(id).remove();
};

/* DISPLAY */
ratingsRef.limitToLast(25).on("value", snap => {
  list.innerHTML = "";
  snap.forEach(child => {
    const r = child.val();
    const div = document.createElement("div");
    div.className = "rating";
    div.innerHTML = `
      <b>${r.name}</b> (${r.character})<br>
      <span class="stars">${"â˜…".repeat(r.stars)}</span><br>
      PP: ${r.pp}<br>
      ${r.review || ""}
      ${isAdmin ? `<br><button onclick="deleteRating('${child.key}')">Delete</button>` : ""}
    `;
    list.prepend(div);
  });
});
</script>

</body>
</html>
