<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TiffanyTinx Ratings</title>

<link href="https://fonts.googleapis.com/css2?family=Metal+Mania&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
body {
  background:#0a0a0a;
  color:#eee;
  font-family:'Cinzel', serif;
  padding:20px;
}

.container {
  max-width:800px;
  margin:auto;
  background:#151515;
  padding:30px;
  border-radius:12px;
  border:4px solid #ff0000;
  box-shadow:0 0 25px rgba(255,0,0,.5);
}

h1 {
  font-family:'Metal Mania', cursive;
  text-align:center;
  font-size:4em;
  color:#ff0000;
  margin-bottom:30px;
}

label {
  display:block;
  margin-top:15px;
  margin-bottom:5px;
  color:#ffaaaa;
}

input, select, textarea {
  width:100%;
  padding:10px;
  background:#222;
  border:2px solid #ff0000;
  color:#fff;
  border-radius:6px;
}

/* ðŸ”¥ SAVE BUTTON */
#saveBtn {
  margin-top:20px;
  width:100%;
  padding:15px;
  font-size:1.2em;
  font-weight:bold;
  letter-spacing:1px;
  background:linear-gradient(145deg,#ff0000,#aa0000);
  border:none;
  border-radius:10px;
  color:white;
  cursor:pointer;
  box-shadow:
    0 6px #550000,
    0 0 15px rgba(255,0,0,.8);
  transition:all .15s ease;
  position:relative;
}

#saveBtn i {
  margin-right:8px;
  transition:transform .15s ease;
}

#saveBtn:active {
  transform:translateY(6px);
  box-shadow:
    0 0 #550000,
    0 0 25px rgba(255,0,0,1);
}

#saveBtn:active i {
  transform:scale(1.3) rotate(-10deg);
}

#saveBtn::after {
  content:"";
  position:absolute;
  inset:0;
  border-radius:10px;
  box-shadow:0 0 30px rgba(255,0,0,.6);
  opacity:0;
  transition:opacity .2s;
}

#saveBtn:active::after {
  opacity:1;
}

/* RATINGS */
.rating {
  background:#222;
  margin-top:20px;
  padding:15px;
  border-radius:8px;
  border:1px solid #444;
}

.stars {
  color:gold;
  font-size:1.3em;
}
</style>
</head>

<body>

<div class="container">
<h1>TiffanyTinx</h1>

<label>Name</label>
<input id="name" placeholder="Anonymous">

<label>Character</label>
<select id="character">
  <option>Pim</option>
  <option>Charlie</option>
  <option>Glep</option>
  <option>Mr Boss</option>
</select>

<label>Stars</label>
<select id="stars">
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
</select>

<label>PP Energy</label>
<select id="pp">
  <option>1</option><option>2</option><option>3</option>
  <option>4</option><option>5</option><option>6</option>
  <option>7</option><option>8</option><option>9</option><option>10</option>
</select>

<label>Comment</label>
<textarea id="review"></textarea>

<button id="saveBtn">
  <i class="fas fa-skull"></i> SAVE RATING
</button>

<div id="list"></div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC7srqV5cigcYZEdGIW5O8jl-LoA5nNECk",
  authDomain: "tiffanytinx-bbf9c.firebaseapp.com",
  databaseURL: "https://tiffanytinx-bbf9c-default-rtdb.firebaseio.com",
  projectId: "tiffanytinx-bbf9c"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const ratingsRef = db.ref("ratings");

/* iOS stability */
firebase.database().goOffline();
firebase.database().goOnline();

/* SAVE */
document.getElementById("saveBtn").onclick = () => {
  const stars = parseInt(starsEl.value);

  const rating = {
    name: nameEl.value || "Anonymous",
    character: characterEl.value,
    stars,
    pp: parseInt(ppEl.value),
    review: reviewEl.value,
    timestamp: Date.now(),
    isToken: stars === 5,
    ...(stars === 5 ? { claimed:false } : {})
  };

  ratingsRef.push(rating);
  nameEl.value = reviewEl.value = "";
};

/* DOM refs */
const nameEl = document.getElementById("name");
const characterEl = document.getElementById("character");
const starsEl = document.getElementById("stars");
const ppEl = document.getElementById("pp");
const reviewEl = document.getElementById("review");
const list = document.getElementById("list");

/* DISPLAY */
ratingsRef.limitToLast(20).on("value", snap => {
  list.innerHTML = "";
  snap.forEach(child => {
    const r = child.val();
    const div = document.createElement("div");
    div.className = "rating";
    div.innerHTML = `
      <b>${r.name}</b> (${r.character})<br>
      <span class="stars">${"â˜…".repeat(r.stars)}</span><br>
      PP: ${r.pp}<br>
      ${r.review || ""}
    `;
    list.prepend(div);
  });
});
</script>

</body>
</html>
